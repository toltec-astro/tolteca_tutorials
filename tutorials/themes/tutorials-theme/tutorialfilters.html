<script>
  $(document).ready(function(){
      //to retain the scroll position
      if (sessionStorage.scrollTop != "undefined") {
        $(window).scrollTop(sessionStorage.scrollTop);
      }

      //checking the active filters
      var activeFilters = $.getQueryParameters();
      var filters = document.getElementsByClassName('custom-control-input');
      for (var f=0; filters[f]; ++f){
          if (activeFilters.q[0].search(filters[f].value)!=-1)
              filters[f].checked = true;
      }
      document.getElementById("search-bar-input").value = '';
  
      //number of results found
      setTimeout(function() {
          if (!document.getElementsByClassName('result-card').length)
              {document.getElementById('search-results').innerHTML += '<h3>No tutorials found!</h3>';}
          else{
            document.getElementById('search-results').innerHTML = ('<h4>'+document.getElementsByClassName('result-card').length +' tutorials found</h4>') + document.getElementById('search-results').innerHTML;
          }
      },1000);
  });

  //update filters
  function applyFilter(){
      sessionStorage.scrollTop = $(window).scrollTop(); //to store the current scroll position
      var checkedValue = 'filterTutorials';    //because we only want to search the tutorials
      var inputElements = document.getElementsByClassName('custom-control-input');
      for(var i=0; inputElements[i]; ++i){
          if(inputElements[i].checked){
              checkedValue += '+' + inputElements[i].value ;   //new query
          }
      }
      var url = window.location.href.split("tutorials.html")[0] + "tutorials.html?q=" + checkedValue;
      window.location.href = url;
  }

  //search filter
  function filterFunction() {
        var input, filterQuery, filterDiv, filterDivLabel, ul, li, i;
        input = document.getElementById("filter-search");
        filterQuery = input.value.toUpperCase();
        filterDiv = document.getElementsByClassName("custom-control");
        filterDivLabel = document.getElementsByClassName("custom-control-label");
        for (i = 0; i < filterDiv.length; i++) {
          if (filterDivLabel[i].innerHTML.toUpperCase().indexOf(filterQuery) > -1) {
            filterDiv[i].style.display = "";
          } else {
            filterDiv[i].style.display = "none";
          }
        }

        var toggleCollapse, viewButton, j;
        toggleCollapse = document.getElementsByClassName("collapse");
        viewButton = document.getElementsByClassName("view-button");
        for(j = 0; j < toggleCollapse.length; j++){
          toggleCollapse[j].className = "collapse in";
          viewButton[j].children[0].style.display = "none";
          viewButton[j].children[1].style.display = "none";
        }

        if(filterQuery == ""){
          for(j = 0; j < toggleCollapse.length; j++){
            toggleCollapse[j].className = "collapse";
            viewButton[j].children[0].style.display = "";
            viewButton[j].children[1].style.display = "none";
          }
        }

      }
</script>

<form action="">
  <div class="form-group">
    <input type="text" name="q" id="filter-search" class="form-control" placeholder="Search for a filter" onkeyup="filterFunction()"/>
  </div>
  </form>

  <!-- TolTECA Packages -->
  <h3 style="font-size: 1rem; font-weight: 500; text-decoration: none;">TolTECA package</h3>
  <form name="filterForm" class="form-group" style="padding-left: 20px; margin-bottom: 0;" action="">
    <div class="custom-control custom-checkbox">
      <input type="checkbox" name="q" class="custom-control-input" id="customCheck1" value="filtertoltecadatamodels" onClick="applyFilter()">
      <label class="custom-control-label" for="customCheck1">tolteca.datamodels</label>
    </div>
    <div class="custom-control custom-checkbox">
      <input type="checkbox" name="q" class="custom-control-input" id="customCheck2" value="filtertoltecasimu" onClick="applyFilter()">
      <label class="custom-control-label" for="customCheck2">tolteca.simu</label>
    </div>
    <div class="custom-control custom-checkbox">
      <input type="checkbox" name="q" class="custom-control-input" id="customCheck3" value="filtertoltecareduce" onClick="applyFilter()">
      <label class="custom-control-label" for="customCheck3">tolteca.reduce</label>
    </div>
    <!-- Display 3 in compact view -->
      <div class="collapse" id="viewmore1">
    <!-- -->
    <div class="custom-control custom-checkbox">
      <input type="checkbox" name="q" class="custom-control-input" id="customCheck4" value="filterdasha" onClick="applyFilter()">
      <label class="custom-control-label" for="customCheck4">dasha</label>
    </div>
    <div class="custom-control custom-checkbox">
      <input type="checkbox" name="q" class="custom-control-input" id="customCheck5" value="filterkidsproc" onClick="applyFilter()">
      <label class="custom-control-label" for="customCheck5">kidsproc</label>
    </div>
  </div>
  <a data-toggle="collapse" data-target="#viewmore1" aria-expanded="false" style="text-decoration: none !important" class="view-button">

    <span id="viewmore" style="text-decoration: none !important; color: #ff6a22 !important; font-size: 0.8rem;">
      VIEW MORE
    </span>
    <span id="viewless" style="text-decoration: none !important; color: #ff6a22 !important; font-size: 0.8rem;">
      VIEW LESS
    </span>

  </a>
  </form>

  <!-- Task -->
  <h3 style="font-size: 1rem; font-weight: 500; text-decoration: none; padding-top: 15px;">Task</h3>
  <form  name="filterForm" class="form-group" style="padding-left: 20px; margin-bottom: 0;" action="">
    <div class="custom-control custom-checkbox">
      <input type="checkbox" name="q" class="custom-control-input" id="customCheck22" value="filterrawdata" onClick="applyFilter()">
      <label class="custom-control-label" for="customCheck22">raw data</label>
    </div>
    <div class="custom-control custom-checkbox">
      <input type="checkbox" name="q" class="custom-control-input" id="customCheck23" value="filterreduceddata" onClick="applyFilter()">
      <label class="custom-control-label" for="customCheck23">reduced data</label>
    </div>
    <div class="custom-control custom-checkbox">
      <input type="checkbox" name="q" class="custom-control-input" id="customCheck24" value="filterkidsdata" onClick="applyFilter()">
      <label class="custom-control-label" for="customCheck24">KIDs data</label>
    </div>
    <!-- -->
    <div class="collapse" id="viewmore2">
    <!-- -->
    <div class="custom-control custom-checkbox">
      <input type="checkbox" name="q" class="custom-control-input" id="customCheck25" value="filterdataproductdatabase" onClick="applyFilter()">
      <label class="custom-control-label" for="customCheck25">data product database</label>
    </div>
  </div>

  <a data-toggle="collapse" data-target="#viewmore2" aria-expanded="false" style="text-decoration: none !important" class="view-button">

    <span id="viewmore" style="text-decoration: none !important; color: #ff6a22 !important; font-size: 0.8rem;">
      VIEW MORE
    </span>
    <span id="viewless" style="text-decoration: none !important; color: #ff6a22 !important; font-size: 0.8rem;">
      VIEW LESS
    </span>

  </a>
  </form>

  <!-- Science -->
  <h3 style="font-size: 1rem; font-weight: 500; text-decoration: none; padding-top: 15px;">Science</h3>
  <form  name="filterForm" class="form-group" style="padding-left: 20px; margin-bottom: 0;" action="">
    <div class="custom-control custom-checkbox">
      <input type="checkbox" name="q" class="custom-control-input" id="customCheck44" value="filterobservationplanning" onClick="applyFilter()">
      <label class="custom-control-label" for="customCheck44">observation planing</label>
    </div>
    <div class="custom-control custom-checkbox">
      <input type="checkbox" name="q" class="custom-control-input" id="customCheck43" value="filtersignaltonoisecalculator" onClick="applyFilter()">
      <label class="custom-control-label" for="customCheck43">signal-to-noise calculator</label>
    </div>
    <!-- -->
    <div class="collapse" id="viewmore3">
    <!-- -->
    <div class="custom-control custom-checkbox">
      <input type="checkbox" name="q" class="custom-control-input" id="customCheck48" value="filterendtoendsimulation" onClick="applyFilter()">
      <label class="custom-control-label" for="customCheck48">end-to-end simulation</label>
    </div>

</div>

  <a data-toggle="collapse" data-target="#viewmore3" aria-expanded="false" style="text-decoration: none !important" class="view-button">

    <span id="viewmore" style="text-decoration: none !important; color: #ff6a22 !important; font-size: 0.8rem;">
      VIEW MORE
    </span>
    <span id="viewless" style="text-decoration: none !important; color: #ff6a22 !important; font-size: 0.8rem;">
      VIEW LESS
    </span>

  </a>
  </form>
